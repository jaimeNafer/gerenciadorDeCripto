<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Evolução do Patrimônio</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
        }
        #main {
            width: 100%;
            height: 100vh;
            background-color: white;
        }
    </style>
</head>
<body>
    <div id="main"></div>
    
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));
        
        // Dados padrão (serão substituídos via JavaScript)
        var defaultData = {
            dates: ['08/24', '09/24', '10/24', '11/24', '12/24', '01/25', '02/25', '03/25', '04/25', '05/25', '06/25', '07/25', '08/25'],
            valorAplicado: [5000, 6000, 8000, 12000, 15000, 18000, 20000, 22000, 25000, 28000, 30000, 32000, 35000],
            ganhoCapital: [0, 500, 1000, 2000, 3000, 2500, 4000, 5000, 4500, 6000, 7000, 8000, 9000]
        };
        
        function updateChart(data = defaultData) {
            var option = {
                title: {
                    text: 'Evolução do Patrimônio',
                    left: 'center',
                    textStyle: {
                        fontSize: 18,
                        fontWeight: 'bold',
                        color: '#333'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function (params) {
                        var result = params[0].name + '<br/>';
                        var total = 0;
                        params.forEach(function(item) {
                            result += item.marker + item.seriesName + ': R$ ' + 
                                     item.value.toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '<br/>';
                            total += item.value;
                        });
                        result += '<strong>Total: R$ ' + total.toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '</strong>';
                        return result;
                    }
                },
                legend: {
                    data: ['Valor Aplicado', 'Ganho Capital'],
                    top: '10%',
                    left: 'center'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '20%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: data.dates,
                    axisLabel: {
                        fontSize: 11,
                        color: '#666'
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: function (value) {
                            if (value >= 1000) {
                                return (value / 1000) + 'k';
                            }
                            return value;
                        },
                        fontSize: 11,
                        color: '#666'
                    }
                },
                series: [
                    {
                        name: 'Valor Aplicado',
                        type: 'bar',
                        stack: 'total',
                        data: data.valorAplicado,
                        itemStyle: {
                            color: '#ff6b6b'
                        }
                    },
                    {
                        name: 'Ganho Capital',
                        type: 'bar',
                        stack: 'total',
                        data: data.ganhoCapital,
                        itemStyle: {
                            color: '#4ecdc4'
                        }
                    }
                ]
            };
            
            myChart.setOption(option);
        }
        
        // Função para receber dados do Kotlin
        window.updateChartData = function(jsonData) {
            try {
                var data = JSON.parse(jsonData);
                updateChart(data);
            } catch (e) {
                console.error('Erro ao parsear dados:', e);
                updateChart(); // Usar dados padrão em caso de erro
            }
        };
        
        // Inicializar com dados padrão
        updateChart();
        
        // Responsividade
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</body>
</html>